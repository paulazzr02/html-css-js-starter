// ========================================
// Form 컴포넌트 스타일
// @group components
// @description 범용 폼 요소 (체크박스, 라디오 버튼, 입력 필드, 셀렉트 등)
// 여러 컴포넌트에서 재사용 가능한 폼 요소 스타일 (BEM 규칙 준수)
// ========================================

@use 'sass:map';
@use 'abstracts/variables' as *;
@use 'abstracts/config' as *;

// ----------------------------------------
// Mixins
// ----------------------------------------

// 공통 기본 스타일 Mixin
@mixin form-control-base {
  width: 100%;
  box-sizing: border-box;
  padding: 0.375rem 0.75rem; // 디폴트 36px 높이
  border: 0.5px solid $cs-border-color;
  border-radius: map.get($border-radius-map, 1); // 1 (var(--krds-number-2) = 0.2rem)
  font-size: $cs-font-size-base; // 1rem (16px)
  font-weight: 500;
  line-height: 1.5; // 텍스트 높이: 1.5rem (24px)
  transition: border-color $cs-transition-fast;
  // 총 높이 계산: 0.375rem (상) + 1.5rem (텍스트) + 0.375rem (하) + 0.0625rem (border) ≈ 2.25rem (36px)
}

// 입력 필드 기본 스타일 Mixin
@mixin input-base {
  @include form-control-base;
  background-color: $cs-color-white;
  color: $cs-color-text-primary;

  &::placeholder {
    color: $cs-color-text-muted;
  }

  &:focus {
    outline: none;
    border-color: $cs-color-primary;
  }

  &:disabled {
    background-color: $cs-toolbar--background-disabled;
    cursor: not-allowed;
    opacity: 0.6;
  }
}

// 셀렉트 기본 스타일 Mixin
@mixin select-base {
  @include form-control-base;
  color: $cs-color-text-muted;
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  cursor: pointer;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23666' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 0.75rem center;
  background-size: 0.75rem 0.75rem;
  padding-right: 2.25rem; // 화살표 공간 확보

  &:focus {
    outline: none;
    border-color: $cs-input--border-focus-color;
  }

  // 선택된 옵션 스타일
  option {
    background-color: $cs-color-white;
    color: $cs-color-text-primary;
  }
}

// 체크박스 기본 스타일 Mixin
@mixin checkbox-base {
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  cursor: pointer;
  margin: 0;
  padding: 0;
  border: 1.5px solid $cs-border-color;
  border-radius: 50%;
  background-color: $cs-color-white;
  position: relative;
  transition: all $cs-transition-fast;
  flex-shrink: 0;

  // 선택된 상태
  &:checked {
    border-color: $cs-input--border-focus-color;
    background-color: $cs-input--border-focus-color;

    // 체크마크 (✓)
    &::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) rotate(45deg);
      width: 0.25rem;
      height: 0.5rem;
      border: solid $cs-color-white;
      border-width: 0 2px 2px 0;
      border-radius: 0;
    }
  }

  // 호버 상태
  &:hover:not(:disabled) {
    border-color: $cs-color-primary;
    box-shadow: 0 0 0 0.125rem rgba($cs-color-primary, 0.1);
  }

  // 포커스 상태
  &:focus {
    outline: none;
    border-color: $cs-input--border-focus-color;
    box-shadow: 0 0 0 0.125rem rgba($cs-color-primary, 0.1);
  }

  // 비활성화 상태
  &:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background-color: $cs-toolbar--background-disabled;
  }
}

// 라디오 버튼 기본 스타일 Mixin
@mixin radio-base {
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  cursor: pointer;
  margin: 0;
  padding: 0;
  border: 1.5px solid $cs-border-color;
  border-radius: 50%;
  background-color: $cs-border-color;
  position: relative;
  transition: all $cs-transition-fast;
  flex-shrink: 0;

  // 선택된 상태
  &:checked {
    border-color: $cs-border-color;
    background-color: $cs-border-color;

    // 내부 원 (선택 표시)
    &::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 0.875rem;
      height: 0.875rem;
      border-radius: 50%;
      background-color: $cs-input--border-focus-color;
    }
  }

  // 호버 상태
  &:hover:not(:disabled) {
    border-color: $cs-color-primary;
    box-shadow: 0 0 0 0.125rem rgba($cs-color-primary, 0.1);
  }

  // 비활성화 상태
  &:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background-color: $cs-toolbar--background-disabled;
  }
}

// ----------------------------------------
// Form Elements
// ----------------------------------------

// Form Field Container
.c-form-field {
  // 디폴트 수직 배치
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  gap: 0.5rem;

  // 수평 배치 Modifier
  &--hr {
    flex-direction: row;
    align-items: center;
  }
}

.c-form-label {
  font-weight: 500;
  color: $cs-color-text-primary;
  line-height: 1.5;
  white-space: nowrap;
  flex-shrink: 0;
}

// Input Wrapper (입력 필드와 에러 메시지 포함)
.c-form-input-wrapper {
  flex: 1; // 기본값: 남은 공간 모두 사용 (inputWidth가 없을 때)
  min-width: 0; // flex 축소 허용
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
  position: relative; // 드롭다운 위치 기준점
  overflow: visible; // 드롭다운이 잘리지 않도록
  // inputWidth가 지정되면 HTML에서 flex: 0 0 auto로 오버라이드됨

  // 라디오 그룹이 포함된 경우 정렬 조정
  // 라디오 그룹만 포함하고 에러 메시지가 없을 때는 중앙 정렬
  .c-form-radio-group:first-child:last-child {
    margin-top: auto;
    margin-bottom: auto;
  }
}

// Checkbox
.c-form-checkbox {
  @include checkbox-base;
  width: 1.25rem;
  height: 1.25rem;
}

// Radio
.c-form-radio {
  @include radio-base;
  width: 1.25rem;
  height: 1.25rem;
}

// Radio Label Element
.c-form-radio__label {
  color: $cs-color-text-primary;
  cursor: pointer;
  user-select: none;
  transition: color $cs-transition-fast;
}

// Radio Group
.c-form-radio-group {
  display: flex;
  flex-direction: row;
  gap: 1rem;
  align-items: center;
  min-height: 2.25rem; // 다른 폼 요소들과 동일한 높이 (36px)
}

// Radio Wrapper
.c-form-radio-wrapper {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

// Input
.c-form-input {
  @include input-base;
}

// Select
.c-form-select {
  @include select-base;
}

// Multiselect
.c-form-multiselect {
  position: relative;
  width: 100%;

  // Display 버튼
  &__display {
    @include form-control-base;
    display: flex;
    align-items: center;
    justify-content: space-between;
    background-color: $cs-color-white;
    color: $cs-color-text-primary;
    cursor: pointer;
    text-align: left;
    width: 100%;

    &:hover:not(:disabled) {
      border-color: $cs-color-primary;
    }

    &:focus {
      outline: none;
      border-color: $cs-input--border-focus-color;
      box-shadow: 0 0 0 0.125rem rgba($cs-color-primary, 0.1);
    }

    &.is-open {
      border-color: $cs-input--border-focus-color;
    }

    &:disabled {
      background-color: $cs-toolbar--background-disabled;
      cursor: not-allowed;
      opacity: 0.6;
    }
  }

  // Display 텍스트
  &__text {
    flex: 1;
    min-width: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    color: $cs-color-text-primary;

    &.is-placeholder {
      color: $cs-color-text-muted;
    }
  }

  // Display 아이콘
  &__icon {
    width: 0.75rem;
    height: 0.75rem;
    color: $cs-color-text-muted;
    flex-shrink: 0;
    margin-left: 0.5rem;
    transition: transform $cs-transition-fast;
    font-size: 0.625rem;
    line-height: 1;

    .is-open & {
      transform: rotate(180deg);
    }
  }

  // Dropdown
  &__dropdown {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    margin-top: 0.25rem;
    background-color: $cs-color-white;
    border: 0.5px solid $cs-border-color;
    border-radius: map.get($border-radius-map, 1);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    z-index: $cs-zindex-fixed;
    max-height: 300px;
    overflow-y: auto;
  }

  // Options 컨테이너
  &__options {
    display: flex;
    flex-direction: column;
    padding: 0.25rem;
    gap: 0.125rem;
  }

  // Option
  &__option {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 0.75rem;
    border-radius: map.get($border-radius-map, 1);
    cursor: pointer;
    transition: background-color $cs-transition-fast;
    color: $cs-color-text-primary;

    &:hover,
    &.is-focused {
      background-color: $cs-color-background-secondary;
    }

    &.is-selected {
      background-color: rgba($cs-color-primary, 0.1);
    }
  }

  // Checkbox
  &__checkbox {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 1rem;
    height: 1rem;
    border: 1.5px solid $cs-border-color;
    border-radius: map.get($border-radius-map, 1);
    background-color: $cs-color-white;
    flex-shrink: 0;
    transition: all $cs-transition-fast;

    &.is-checked {
      border-color: $cs-input--border-focus-color;
      background-color: $cs-input--border-focus-color;
    }
  }

  // Checkmark
  &__checkmark {
    color: $cs-color-white;
    font-size: 0.75rem;
    line-height: 1;
    font-weight: bold;
  }

  // Option 텍스트
  &__option-text {
    flex: 1;
    font-size: $cs-font-size-base;
    line-height: 1.5;
  }
}
